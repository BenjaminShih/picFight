<!DOCTYPE html>
<html>
<head>
	<title>picFight</title>
	<style type="text/css">
		.pic {
			position: relative;
			display: inline-block;
			margin: 20px;
		}
		.pic__text {
			position: absolute;
			bottom: 40px;
			width: 100%;
			text-align: center;
		}
		.pic__body {
			width: 190px;
			height: 190px;
		}
		.pic__edit {
			margin: 0 auto;
			text-align: center;
		}
		.pic__edit__clear {
			cursor: pointer;
			margin-left: 5px;
		}
	</style>
	<script src="https://unpkg.com/vue/dist/vue.js"></script>
	<!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
	<script src="https://cdn.jsdelivr.net/vue.resource/1.2.1/vue-resource.min.js"></script>
</head>
<body>
<div id="app">
	<div class="pic" v-for="item in picArr">
		<img class="pic__body" :src="item.url">
		<div class="pic__text">{{item.text}}</div>
		<div class="pic__edit">
			<input type="text" class="pic__edit__text" v-model="item.text">
			<button class="pic__edit__clear" @click="clearPicText(item)">C</button>
		</div>
	</div>
	<input type="file" @change="upload">
</div>
<script>
	var app = new Vue({
		el: '#app',
		data: function() {
			return{
				picArr : []
			}
		},
		mounted: function() {
			// 初始化加载数据库中的图片
			this.loadPics();
		},
		methods: {
			// 清空输入框
			clearPicText: function(item) {
				item.text = '';
			},
			// 上传图片
			upload: function(e) {
				let formData = new FormData();
				formData.append('uploadfile', e.target.files[0]);
				console.log('formData', formData)
				this.$http.post('/upload', formData)
				.then(function (response) {
				    console.log('upload success!');
				    this.loadPics()
				}, function(err) {
					console.log('upload err -', err)
				})
			},
			// 加载图片
			loadPics: function() {
				this.$http.post('/pics', {}).then(function(res) {
					let arr =  res.data
					if(Array.isArray(arr)) {
						this.picArr = arr;
					}
				})
			},
		}
	})
</script>
</body>
</html>